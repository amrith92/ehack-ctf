var map=null;var currentLocation=null;var UsersLoader={usersLayers:new Array(),removeUsers:function(){for(var a=0;a<UsersLoader.usersLayers.length;++a){map.removeLayer(UsersLoader.usersLayers[a])}UsersLoader.usersLayers=[]},requestUsers:function(){if(map.getZoom()>=13){var b=map.getBounds();var a=[{lat:b.getSouthWest().lat,lng:b.getSouthWest().lng},{lat:b.getNorthWest().lat,lng:b.getNorthWest().lng},{lat:b.getNorthEast().lat,lng:b.getNorthEast().lng},{lat:b.getSouthEast().lat,lng:b.getSouthEast().lng}];$.get(Routing.generate("ctf_statistics_nearby_users_pub",{bounds:JSON.stringify(a)}),null,function(c){UsersLoader.onUsersLoaded(JSON.parse(c))})}else{UsersLoader.removeUsers()}},onUsersLoaded:function(a){if("success"==a.status){UsersLoader.removeUsers();var d=a.users,b;for(b=0;b<d.length;++b){var c=new L.marker(d[b].location,{title:d[b].username});c.bindPopup('<div class="row-fluid"><div class="span12"><h2 style="color:#000;">'+d[b].fname+" "+d[b].lname+'</h2></div></div><div class="row-fluid"><div class="span4"><img src="'+d[b].dp+'" title="'+d[b].username+'\'s Profile Picture" class="img-polaroid" width="50"></div><div style="color:#000;" class="span8"><a href="'+Routing.generate("ctf_public_profile",{id:d[b].id})+'" target="_blank">@'+d[b].username+"</a></div></div>");map.addLayer(c);UsersLoader.usersLayers.push(c)}}}};