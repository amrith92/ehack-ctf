var bb={success:0,error:0,blackberryTimeoutId:-1};function handleBlackBerryLocationTimeout(){if(bb.blackberryTimeoutId!=-1){bb.error({message:"Timeout error",code:3})}}function handleBlackBerryLocation(){clearTimeout(bb.blackberryTimeoutId);bb.blackberryTimeoutId=-1;if(bb.success&&bb.error){if(blackberry.location.latitude==0&&blackberry.location.longitude==0){bb.error({message:"Position unavailable",code:2})}else{var a=null;if(blackberry.location.timestamp){a=new Date(blackberry.location.timestamp)}bb.success({timestamp:a,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb.success=null;bb.error=null}}var geoPosition=function(){var d={};var b=null;var a="undefined";var c="http://freegeoip.net/json/?callback=JSONPCallback";d.getCurrentPosition=function(g,f,e){b.getCurrentPosition(g,f,e)};d.jsonp={callbackCounter:0,fetch:function(h,f){var g="JSONPCallback_"+this.callbackCounter++;window[g]=this.evalJSONP(f);h=h.replace("=JSONPCallback","="+g);var e=document.createElement("SCRIPT");e.src=h;document.getElementsByTagName("HEAD")[0].appendChild(e)},evalJSONP:function(e){return function(f){e(f)}}};d.confirmation=function(){return confirm("This Webpage wants to track your physical location.\nDo you allow it?")};d.init=function(){try{var g=typeof(navigator.geolocation)!=a;if(!g){if(!d.confirmation()){return false}}if((typeof(geoPositionSimulator)!=a)&&(geoPositionSimulator.length>0)){b=geoPositionSimulator}else{if(typeof(bondi)!=a&&typeof(bondi.geolocation)!=a){b=bondi.geolocation}else{if(g){b=navigator.geolocation;d.getCurrentPosition=function(i,h,e){function j(k){var l;if(typeof(k.latitude)!=a){l={timestamp:k.timestamp,coords:{latitude:k.latitude,longitude:k.longitude}}}else{l=k}i(l)}b.getCurrentPosition(j,h,e)}}else{if(typeof(window.blackberry)!=a&&blackberry.location.GPSSupported){if(typeof(blackberry.location.setAidMode)==a){return false}blackberry.location.setAidMode(2);d.getCurrentPosition=function(i,h,e){bb.success=i;bb.error=h;if(e.timeout){bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",e.timeout)}else{bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",60000)}blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation()};b=blackberry.location}else{if(typeof(Mojo)!=a&&typeof(Mojo.Service.Request)!="Mojo.Service.Request"){b=true;d.getCurrentPosition=function(i,h,e){parameters={};if(e){if(e.enableHighAccuracy&&e.enableHighAccuracy==true){parameters.accuracy=1}if(e.maximumAge){parameters.maximumAge=e.maximumAge}if(e.responseTime){if(e.responseTime<5){parameters.responseTime=1}else{if(e.responseTime<20){parameters.responseTime=2}else{parameters.timeout=3}}}}r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(j){i({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})},onFailure:function(j){if(j.errorCode==1){h({code:3,message:"Timeout"})}else{if(j.errorCode==2){h({code:2,message:"Position unavailable"})}else{h({code:0,message:"Unknown Error: webOS-code"+errorCode})}}}})}}else{if(typeof(device)!=a&&typeof(device.getServiceObject)!=a){b=device.getServiceObject("Service.Location","ILocation");d.getCurrentPosition=function(j,i,h){function e(n,m,l){if(m==4){i({message:"Position unavailable",code:2})}else{j({timestamp:null,coords:{latitude:l.ReturnValue.Latitude,longitude:l.ReturnValue.Longitude,altitude:l.ReturnValue.Altitude,heading:l.ReturnValue.Heading}})}}var k=new Object();k.LocationInformationClass="BasicLocationInformation";b.ILocation.GetLocation(k,e)}}else{d.getCurrentPosition=function(i,h,e){d.jsonp.fetch(c,function(j){i({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})})};b=true}}}}}}}catch(f){if(typeof(console)!=a){console.log(f)}return false}return b!=null};return d}();
var map,marker=null;function initialiseMap(){var a={center:new google.maps.LatLng(13.081,80.274),zoom:6,mapTypeControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:false,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),a);marker=new google.maps.Marker({position:map.getCenter(),map:map,title:"You are here",draggable:true});map.panTo(marker.getPosition());geocodePosition(marker.getPosition());google.maps.event.addListener(marker,"dragend",function(b){$("#ctf_userbundle_usertype_location").val(b.latLng.lat()+","+b.latLng.lng());geocodePosition(marker.getPosition())})}function initialize(){var b={center:new google.maps.LatLng(-33.8688,151.2195),};var a=document.getElementById("ctf_userbundle_usertype_org");var d={types:["establishment"]};var c=new google.maps.places.Autocomplete(a,d)}function onLocateClick(){if(geoPosition.init()){geoPosition.getCurrentPosition(showPosition,function(){alert("Could not find you! :(")},{enableHighAccuracy:true})}}function showPosition(a){var c=parseFloat(a.coords.latitude);var d=parseFloat(a.coords.longitude);$("#ctf_userbundle_usertype_location").val(c+","+d);var b=new google.maps.LatLng(c,d);map.setCenter(b);map.setZoom(14);if(null===marker){marker=new google.maps.Marker({position:b,map:map,title:"You are here",draggable:true});geocodePosition(marker.getPosition());google.maps.event.addListener(marker,"dragend",function(e){$("#ctf_userbundle_usertype_location").val(e.latLng.lat()+","+e.latLng.lng());geocodePosition(marker.getPosition())})}else{marker.setPosition(b)}map.panTo(b)}function geocodePosition(a){geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:a},function(c,b){if(b==google.maps.GeocoderStatus.OK){$("#formatted-address").text(c[0].formatted_address)}})}$(document).ready(function(){$(".date").datepicker({dateFormat:"dd-mm-yy",changeMonth:true,changeYear:true});$("[title]").tooltip();$("#editForm").on("change","#ctf_userbundle_usertype_country",function(){document.getElementById("state-loader").innerHTML=document.getElementById("loader").innerHTML;$.post(Routing.generate("ctf_get_edit_form",null),$("#edit-form").serialize(),function(d){$("#edit-form-container").html(d);$(".date").datepicker({dateFormat:"dd-mm-yy",changeMonth:true,changeYear:true});initialize();initialiseMap();var c=$("#ctf_userbundle_usertype_location").val();if(null!==c){var e=c.split(",");showPosition({coords:{latitude:e[0],longitude:e[1]}})}$('#regTabs a[href="#address"]').tab("show")},"html")});initialize();initialiseMap();var a=$("#ctf_userbundle_usertype_location").val();if(null!=a&&"NaN,NaN"!=a){var b=a.split(",");showPosition({coords:{latitude:b[0],longitude:b[1]}});geocodePosition(marker.getPosition())}});