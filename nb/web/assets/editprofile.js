var bb={success:0,error:0,blackberryTimeoutId:-1};function handleBlackBerryLocationTimeout(){if(bb.blackberryTimeoutId!=-1){bb.error({message:"Timeout error",code:3})}}function handleBlackBerryLocation(){clearTimeout(bb.blackberryTimeoutId);bb.blackberryTimeoutId=-1;if(bb.success&&bb.error){if(blackberry.location.latitude==0&&blackberry.location.longitude==0){bb.error({message:"Position unavailable",code:2})}else{var a=null;if(blackberry.location.timestamp){a=new Date(blackberry.location.timestamp)}bb.success({timestamp:a,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb.success=null;bb.error=null}}var geoPosition=function(){var d={};var c=null;var b="undefined";var a="http://freegeoip.net/json/?callback=JSONPCallback";d.getCurrentPosition=function(f,g,e){c.getCurrentPosition(f,g,e)};d.jsonp={callbackCounter:0,fetch:function(f,g){var h="JSONPCallback_"+this.callbackCounter++;window[h]=this.evalJSONP(g);f=f.replace("=JSONPCallback","="+h);var e=document.createElement("SCRIPT");e.src=f;document.getElementsByTagName("HEAD")[0].appendChild(e)},evalJSONP:function(e){return function(f){e(f)}}};d.confirmation=function(){return confirm("This Webpage wants to track your physical location.\nDo you allow it?")};d.init=function(){try{var g=typeof(navigator.geolocation)!=b;if(!g){if(!d.confirmation()){return false}}if((typeof(geoPositionSimulator)!=b)&&(geoPositionSimulator.length>0)){c=geoPositionSimulator}else{if(typeof(bondi)!=b&&typeof(bondi.geolocation)!=b){c=bondi.geolocation}else{if(g){c=navigator.geolocation;d.getCurrentPosition=function(h,j,e){function i(k){var l;if(typeof(k.latitude)!=b){l={timestamp:k.timestamp,coords:{latitude:k.latitude,longitude:k.longitude}}}else{l=k}h(l)}c.getCurrentPosition(i,j,e)}}else{if(typeof(window.blackberry)!=b&&blackberry.location.GPSSupported){if(typeof(blackberry.location.setAidMode)==b){return false}blackberry.location.setAidMode(2);d.getCurrentPosition=function(h,i,e){bb.success=h;bb.error=i;if(e.timeout){bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",e.timeout)}else{bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",60000)}blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation()};c=blackberry.location}else{if(typeof(Mojo)!=b&&typeof(Mojo.Service.Request)!="Mojo.Service.Request"){c=true;d.getCurrentPosition=function(h,i,e){parameters={};if(e){if(e.enableHighAccuracy&&e.enableHighAccuracy==true){parameters.accuracy=1}if(e.maximumAge){parameters.maximumAge=e.maximumAge}if(e.responseTime){if(e.responseTime<5){parameters.responseTime=1}else{if(e.responseTime<20){parameters.responseTime=2}else{parameters.timeout=3}}}}r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(j){h({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})},onFailure:function(j){if(j.errorCode==1){i({code:3,message:"Timeout"})}else{if(j.errorCode==2){i({code:2,message:"Position unavailable"})}else{i({code:0,message:"Unknown Error: webOS-code"+errorCode})}}}})}}else{if(typeof(device)!=b&&typeof(device.getServiceObject)!=b){c=device.getServiceObject("Service.Location","ILocation");d.getCurrentPosition=function(i,k,h){function j(m,l,n){if(l==4){k({message:"Position unavailable",code:2})}else{i({timestamp:null,coords:{latitude:n.ReturnValue.Latitude,longitude:n.ReturnValue.Longitude,altitude:n.ReturnValue.Altitude,heading:n.ReturnValue.Heading}})}}var e=new Object();e.LocationInformationClass="BasicLocationInformation";c.ILocation.GetLocation(e,j)}}else{d.getCurrentPosition=function(h,i,e){d.jsonp.fetch(a,function(j){h({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})})};c=true}}}}}}}catch(f){if(typeof(console)!=b){console.log(f)}return false}return c!=null};return d}();
var map,marker=null;function initialiseMap(){var a={center:new google.maps.LatLng(13.081,80.274),zoom:6,mapTypeControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:false,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),a);marker=new google.maps.Marker({position:map.getCenter(),map:map,title:"You are here",draggable:true});map.panTo(marker.getPosition());geocodePosition(marker.getPosition());google.maps.event.addListener(marker,"dragend",function(b){$("#ctf_userbundle_usertype_location").val(b.latLng.lat()+","+b.latLng.lng());geocodePosition(marker.getPosition())})}function initialize(){var c={center:new google.maps.LatLng(-33.8688,151.2195),};var a=document.getElementById("ctf_userbundle_usertype_org");var d={types:["establishment"]};var b=new google.maps.places.Autocomplete(a,d)}function onLocateClick(){if(geoPosition.init()){geoPosition.getCurrentPosition(showPosition,function(){alert("Could not find you! :(")},{enableHighAccuracy:true})}}function showPosition(a){var b=parseFloat(a.coords.latitude);var c=parseFloat(a.coords.longitude);$("#ctf_userbundle_usertype_location").val(b+","+c);var d=new google.maps.LatLng(b,c);map.setCenter(d);map.setZoom(14);if(null===marker){marker=new google.maps.Marker({position:d,map:map,title:"You are here",draggable:true});geocodePosition(marker.getPosition());google.maps.event.addListener(marker,"dragend",function(e){$("#ctf_userbundle_usertype_location").val(e.latLng.lat()+","+e.latLng.lng());geocodePosition(marker.getPosition())})}else{marker.setPosition(d)}map.panTo(d)}function geocodePosition(a){geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:a},function(b,c){if(c==google.maps.GeocoderStatus.OK){$("#formatted-address").text(b[0].formatted_address)}})}$(document).ready(function(){$(".date").datepicker({dateFormat:"dd-mm-yy",changeMonth:true,changeYear:true});$("[title]").tooltip();$("#editForm").on("change","#ctf_userbundle_usertype_country",function(){document.getElementById("state-loader").innerHTML=document.getElementById("loader").innerHTML;$.post(Routing.generate("ctf_get_edit_form",null),$("#edit-form").serialize(),function(e){$("#edit-form-container").html(e);$(".date").datepicker({dateFormat:"dd-mm-yy",changeMonth:true,changeYear:true});initialize();initialiseMap();var d=$("#ctf_userbundle_usertype_location").val();if(null!==d){var c=d.split(",");showPosition({coords:{latitude:c[0],longitude:c[1]}})}$('#regTabs a[href="#address"]').tab("show")},"html")});initialize();initialiseMap();var b=$("#ctf_userbundle_usertype_location").val();if(null!=b&&"NaN,NaN"!=b){var a=b.split(",");showPosition({coords:{latitude:a[0],longitude:a[1]}});geocodePosition(marker.getPosition())}});